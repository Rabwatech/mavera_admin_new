(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{30052:function(e,a,s){Promise.resolve().then(s.t.bind(s,52445,23)),Promise.resolve().then(s.bind(s,35487))},35487:function(e,a,s){"use strict";s.r(a),s.d(a,{Providers:function(){return T}});var t=s(3827),r=s(64090),n=s(47907),i=s(43169),l=s(46960),o=s(5423),c=s(34059),d=s(92944),m=s(6297),x=s(95032),h=s(82461),g=s(81280),u=s(20244),v=s(4804),p=s(43345),N=s(82220),f=s(7619),b=s(97307),j=s(69475),A=s(15809),y=s(59496),w=s(52235),E=s(53537),_=e=>{let{userRole:a,isOpen:s,onClose:r}=e,l=(0,n.useRouter)(),_=(0,n.usePathname)(),{t:R,direction:S}=(0,i.Z)(),C=e=>("/"!==e||"/"===_)&&_.startsWith(e),M=[{label:R("nav.adminDashboard"),icon:(0,t.jsx)(o.Z,{size:20}),path:"/",roles:[E.i.SUPER_ADMIN]},{label:R("nav.users"),icon:(0,t.jsx)(c.Z,{size:20}),path:"/users",roles:[E.i.SUPER_ADMIN]},{label:R("nav.approvals"),icon:(0,t.jsx)(d.Z,{size:20}),path:"/approvals",roles:[E.i.SUPER_ADMIN]},{label:R("nav.reports"),icon:(0,t.jsx)(m.Z,{size:20}),path:"/reports",roles:[E.i.SUPER_ADMIN]},{label:R("nav.clients"),icon:(0,t.jsx)(x.Z,{size:20}),path:"/clients",roles:[E.i.SUPER_ADMIN]},{label:R("nav.financeDashboard"),icon:(0,t.jsx)(o.Z,{size:20}),path:"/admin/finance",roles:[E.i.FINANCE_MANAGER,E.i.SUPER_ADMIN]},{label:R("nav.invoices"),icon:(0,t.jsx)(h.Z,{size:20}),path:"/admin/finance/invoices",roles:[E.i.FINANCE_MANAGER,E.i.SUPER_ADMIN]},{label:R("nav.financeContracts"),icon:(0,t.jsx)(g.Z,{size:20}),path:"/admin/finance/contracts",roles:[E.i.FINANCE_MANAGER,E.i.SUPER_ADMIN]},{label:R("nav.integrations"),icon:(0,t.jsx)(u.Z,{size:20}),path:"/admin/finance/integrations",roles:[E.i.FINANCE_MANAGER,E.i.SUPER_ADMIN]},{label:R("nav.incomingLeads"),icon:(0,t.jsx)(v.Z,{size:20}),path:"/leads",roles:[E.i.CALL_CENTER,E.i.SUPER_ADMIN]},{label:"Today's Follow-ups",icon:(0,t.jsx)(p.Z,{size:20}),path:"/leads/follow-ups",roles:[E.i.CALL_CENTER,E.i.SUPER_ADMIN]},{label:R("nav.salesDashboard"),icon:(0,t.jsx)(o.Z,{size:20}),path:"/sales-dashboard",roles:[E.i.SALES_AGENT,E.i.SUPER_ADMIN]},{label:R("nav.tours"),icon:(0,t.jsx)(N.Z,{size:20}),path:"/sales/tours",roles:[E.i.SALES_AGENT,E.i.SUPER_ADMIN]},{label:R("nav.pipeline"),icon:(0,t.jsx)(f.Z,{size:20}),path:"/sales/pipeline",roles:[E.i.SALES_AGENT,E.i.SUPER_ADMIN]},{label:R("nav.myCalendar"),icon:(0,t.jsx)(b.Z,{size:20}),path:"/calendar",roles:[E.i.CALL_CENTER,E.i.SALES_AGENT,E.i.SUPER_ADMIN]},{label:R("nav.salesProposals"),icon:(0,t.jsx)(j.Z,{size:20}),path:"/sales/new",roles:[E.i.SALES_AGENT,E.i.SUPER_ADMIN]},{label:R("nav.draftBookings"),icon:(0,t.jsx)(A.Z,{size:20}),path:"/bookings/drafts",roles:[E.i.SALES_AGENT,E.i.SUPER_ADMIN]},{label:R("nav.arrangements"),icon:(0,t.jsx)(y.Z,{size:20}),path:"/arrangements",roles:[E.i.SUPER_ADMIN,E.i.COORDINATOR]}].filter(e=>e.roles.includes(a));return(0,t.jsxs)("aside",{className:"fixed top-0 bottom-0 h-full w-64 bg-white text-gray-600 z-50 flex flex-col font-sans shadow-[0_0_15px_rgba(0,0,0,0.05)] transition-transform duration-300 ease-in-out md:translate-x-0 ".concat("rtl"===S?"right-0 border-l border-gray-100 "+(s?"translate-x-0":"translate-x-full"):"left-0 border-r border-gray-100 "+(s?"translate-x-0":"-translate-x-full")),children:[(0,t.jsxs)("div",{className:"h-20 flex items-center justify-between px-6 border-b border-gray-100",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-mavera-gold rounded-lg flex items-center justify-center shadow-lg shadow-mavera-gold/20 text-white shrink-0",children:(0,t.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",className:"w-6 h-6",stroke:"currentColor",strokeWidth:"2",children:(0,t.jsx)("path",{d:"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"})})}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xl font-bold text-mavera-navy tracking-wide",children:"MAVERA"}),(0,t.jsx)("span",{className:"text-[10px] text-mavera-gold uppercase tracking-widest font-bold",children:"Control Panel"})]})]}),(0,t.jsx)("button",{onClick:r,className:"md:hidden text-gray-400 hover:text-red-500",children:(0,t.jsx)(w.Z,{size:24})})]}),(0,t.jsxs)("nav",{className:"flex-1 overflow-y-auto py-8 px-4",children:[(0,t.jsx)("p",{className:"px-4 text-xs font-bold text-gray-400 mb-4 uppercase tracking-wider",children:R("nav.mainMenu")}),(0,t.jsx)("ul",{className:"space-y-1",children:M.map(e=>(0,t.jsx)("li",{children:(0,t.jsxs)("button",{onClick:()=>{l.push(e.path),r()},className:"w-full flex items-center gap-4 px-4 py-3 rounded-xl transition-all duration-200 group font-medium ".concat(C(e.path)?"bg-amber-50 text-mavera-gold shadow-sm":"text-gray-500 hover:bg-gray-50 hover:text-mavera-navy"),children:[(0,t.jsx)("span",{className:C(e.path)?"text-mavera-gold":"text-gray-400 group-hover:text-mavera-navy transition-colors",children:e.icon}),(0,t.jsx)("span",{children:e.label}),C(e.path)&&(0,t.jsx)("div",{className:"ms-auto w-1.5 h-1.5 rounded-full bg-mavera-gold"})]})},e.path))})]}),(0,t.jsx)("div",{className:"p-6 bg-gray-50 border-t border-gray-100",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-white border border-gray-200 flex items-center justify-center text-xs font-bold text-mavera-navy shadow-sm shrink-0",children:"ID"}),(0,t.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,t.jsx)("span",{className:"text-sm font-bold text-mavera-navy truncate",children:a.replace("_"," ")}),(0,t.jsx)("span",{className:"text-[10px] text-gray-500 uppercase tracking-wide bg-white px-2 py-0.5 rounded border border-gray-100 inline-block mt-1 w-fit",children:"Online"})]})]})})]})},R=s(79744),S=s(29860),C=s(81049),M=s(48219),k=s(62985),P=s(34187),I=e=>{let{isOpen:a,onClose:s}=e,[n,i]=(0,r.useState)([{id:"N001",title:"New Payment Received",titleAr:"دفعة جديدة مستلمة",message:"Payment of 57,000 SAR received for booking B001",messageAr:"دفعة بقيمة 57,000 ريال مستلمة للحجز B001",type:"PAYMENT",isRead:!1,timestamp:"2024-11-30T10:30:00"},{id:"N002",title:"Contract Signed",titleAr:"عقد موقع",message:"Dr. Khalid signed the contract via Nafath",messageAr:"د. خالد وقع العقد عبر نفاذ",type:"CONTRACT",isRead:!1,timestamp:"2024-11-30T09:15:00"},{id:"N003",title:"New Booking Created",titleAr:"حجز جديد",message:"Ahmed created a new booking for Golden Gala",messageAr:"أحمد أنشأ حجز جديد لحفل Golden Gala",type:"BOOKING",isRead:!1,timestamp:"2024-11-29T16:45:00"},{id:"N004",title:"Discount Approval Required",titleAr:"مطلوب موافقة خصم",message:"Sara requested 15% discount approval for booking B005",messageAr:"سارة طلبت موافقة على خصم 15% للحجز B005",type:"APPROVAL",isRead:!0,timestamp:"2024-11-29T14:20:00"},{id:"N005",title:"Vendor Confirmed",titleAr:"مورد تم تأكيده",message:"Royal Flowers confirmed availability for event on 2026-02-15",messageAr:"الزهور الملكية أكدت التوفر للحدث في 2026-02-15",type:"VENDOR",isRead:!0,timestamp:"2024-11-28T11:30:00"}]),[l,o]=(0,r.useState)("en"),d=e=>{i(n.map(a=>a.id===e?{...a,isRead:!0}:a))},m=n.filter(e=>!e.isRead).length,x=e=>{switch(e){case"PAYMENT":return(0,t.jsx)(M.Z,{size:20,className:"text-green-600"});case"CONTRACT":return(0,t.jsx)(j.Z,{size:20,className:"text-purple-600"});case"BOOKING":return(0,t.jsx)(b.Z,{size:20,className:"text-blue-600"});case"APPROVAL":return(0,t.jsx)(k.Z,{size:20,className:"text-orange-600"});case"VENDOR":return(0,t.jsx)(c.Z,{size:20,className:"text-mavera-gold"});case"SYSTEM":return(0,t.jsx)(P.Z,{size:20,className:"text-gray-600"});default:return(0,t.jsx)(p.Z,{size:20,className:"text-gray-400"})}},h=e=>{let a=new Date,s=new Date(e),t=Math.floor((a.getTime()-s.getTime())/1e3);return t<60?"Just now":t<3600?"".concat(Math.floor(t/60)," mins ago"):t<86400?"".concat(Math.floor(t/3600)," hours ago"):"".concat(Math.floor(t/86400)," days ago")};return a?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-40",onClick:s}),(0,t.jsxs)("div",{className:"fixed top-16 right-4 w-full max-w-md bg-white rounded-2xl shadow-2xl z-50 max-h-[calc(100vh-100px)] flex flex-col border border-gray-200",children:[(0,t.jsxs)("div",{className:"px-6 py-4 border-b border-gray-100 flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-mavera-gold/10 rounded-lg",children:(0,t.jsx)(p.Z,{size:20,className:"text-mavera-gold"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-mavera-navy",children:"Notifications"}),m>0&&(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:[m," unread"]})]})]}),(0,t.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,t.jsx)(w.Z,{size:24})})]}),m>0&&(0,t.jsx)("div",{className:"px-6 py-3 border-b border-gray-100 bg-gray-50",children:(0,t.jsx)("button",{onClick:()=>{i(n.map(e=>({...e,isRead:!0})))},className:"text-sm text-mavera-gold hover:text-mavera-goldHover font-medium transition-colors",children:"Mark all as read"})}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:n.length>0?(0,t.jsx)("div",{className:"divide-y divide-gray-100",children:n.map(e=>(0,t.jsx)("div",{className:"px-6 py-4 hover:bg-gray-50 transition-colors cursor-pointer ".concat(e.isRead?"":"bg-blue-50/30"),onClick:()=>d(e.id),children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-white rounded-lg border border-gray-200 shrink-0",children:x(e.type)}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-1",children:[(0,t.jsx)("h3",{className:"font-bold text-sm ".concat(e.isRead?"text-gray-900":"text-mavera-navy"),children:"en"===l?e.title:e.titleAr}),!e.isRead&&(0,t.jsx)("div",{className:"w-2 h-2 bg-mavera-gold rounded-full shrink-0 mt-1"})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"en"===l?e.message:e.messageAr}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:h(e.timestamp)})]})]})},e.id))}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-400",children:[(0,t.jsx)(p.Z,{size:48,className:"mb-4 opacity-20"}),(0,t.jsx)("p",{className:"text-sm",children:"No notifications"})]})})]})]}):null},z=e=>{let{user:a,onRoleSwitch:s,onToggleSidebar:o}=e,c=(0,n.usePathname)(),d=(0,n.useRouter)(),{logout:m}=(0,l.aC)(),{t:x,toggleLanguage:h,language:g,direction:u}=(0,i.Z)(),[v,N]=(0,r.useState)(!1),[f]=(0,r.useState)(3);return(0,t.jsxs)("header",{className:"fixed top-0 h-16 bg-white z-40 px-4 md:px-8 flex items-center justify-between shadow-[0_1px_2px_rgba(0,0,0,0.03)] border-b border-gray-100 transition-all duration-300 ".concat("rtl"===u?"left-0 right-0 md:right-64":"right-0 left-0 md:left-64"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("button",{onClick:o,className:"md:hidden p-2 text-gray-500 hover:bg-gray-100 rounded-lg",children:(0,t.jsx)(R.Z,{size:24})}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"bg-mavera-gold/10 p-1.5 rounded-lg text-mavera-gold hidden sm:block",children:(0,t.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",className:"w-4 h-4",children:(0,t.jsx)("path",{d:"M3 12h18M3 6h18M3 18h18"})})}),(0,t.jsx)("span",{className:"text-gray-300 text-xl font-thin mx-2 hidden sm:inline",children:"|"}),(0,t.jsx)("span",{className:"text-gray-500 text-sm font-medium tracking-wide truncate max-w-[150px] sm:max-w-none",children:(()=>{if((null==c?void 0:c.startsWith("/clients/"))&&"/clients"!==c)return x("clients.detailSubtitle");switch(c){case"/":return x("dash.salesTitle");case"/sales-dashboard":return x("nav.salesDashboard");case"/leads":return x("nav.incomingLeads");case"/sales/new":return x("nav.salesProposals");case"/bookings/drafts":return x("nav.draftBookings");case"/arrangements":return x("nav.arrangements");case"/clients":return x("nav.clients");case"/admin/finance":return"Finance Dashboard";case"/admin/finance/invoices":return"Invoices";default:return"Control Panel"}})()})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 md:gap-6",children:[(0,t.jsxs)("button",{onClick:()=>N(!v),className:"relative p-2 text-gray-500 hover:text-mavera-navy rounded-lg hover:bg-gray-50 transition-colors",children:[(0,t.jsx)(p.Z,{size:20}),f>0&&(0,t.jsx)("span",{className:"absolute top-1 right-1 w-4 h-4 bg-red-600 text-white text-[10px] font-bold rounded-full flex items-center justify-center",children:f})]}),(0,t.jsxs)("button",{onClick:h,className:"flex items-center gap-1 text-gray-500 hover:text-mavera-navy p-1.5 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,t.jsx)(S.Z,{size:20}),(0,t.jsx)("span",{className:"text-xs font-bold uppercase hidden sm:inline",children:"ar"===g?"English":"عربي"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 pl-0 md:pl-6 ".concat("rtl"===u?"md:border-r":"md:border-l"," border-gray-100"),children:[(0,t.jsxs)("div",{className:"text-".concat("rtl"===u?"left":"right"," hidden md:block"),children:[(0,t.jsx)("p",{className:"text-sm font-bold text-mavera-navy leading-none",children:a.name}),(0,t.jsx)("p",{className:"text-[11px] text-gray-400 mt-1",children:a.role.replace("_"," ")})]}),(0,t.jsx)("div",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full bg-mavera-gold text-white flex items-center justify-center font-bold shadow-lg shadow-mavera-gold/20 ring-2 ring-white text-sm md:text-base",children:a.avatar}),(0,t.jsx)("button",{onClick:()=>{confirm("هل أنت متأكد من تسجيل الخروج؟")&&(m(),d.push("/login"))},className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"تسجيل الخروج",children:(0,t.jsx)(C.Z,{size:20})})]})]}),(0,t.jsx)(I,{isOpen:v,onClose:()=>N(!1)})]})};let D=e=>{let{children:a}=e,s=(0,n.usePathname)(),o=(0,n.useRouter)(),{user:c,logout:d}=(0,l.aC)(),[m,x]=(0,r.useState)(!1),{direction:h}=(0,i.Z)(),g=["/login"].includes(s);return((0,r.useEffect)(()=>{c||g||o.push("/login"),c&&"/login"===s&&o.push("/")},[c,s,g,o]),c||g)?g?(0,t.jsx)(t.Fragment,{children:a}):c?(0,t.jsxs)("div",{className:"flex min-h-screen bg-[#F9FAFB] font-sans overflow-x-hidden",dir:h,children:[m&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:()=>x(!1)}),(0,t.jsx)(_,{userRole:c.role,isOpen:m,onClose:()=>x(!1)}),(0,t.jsx)(z,{user:c,onRoleSwitch:()=>{},onToggleSidebar:()=>x(!m)}),(0,t.jsx)("main",{className:"flex-1 mt-16 p-4 md:p-8 transition-all duration-300 ".concat("rtl"===h?"md:mr-64":"md:ml-64"),children:a})]}):null:null};function T(e){let{children:a}=e;return(0,t.jsx)(i.i,{children:(0,t.jsx)(l.Ho,{children:(0,t.jsx)(D,{children:a})})})}},46960:function(e,a,s){"use strict";s.d(a,{Ho:function(){return o},aC:function(){return c},gI:function(){return d},i4:function(){return n.i}});var t=s(3827),r=s(64090),n=s(53537);let i={[n.i.SUPER_ADMIN]:["finance.view","finance.manage_invoices","finance.create_invoice","finance.sync_erp","finance.view_contracts","finance.manage_integrations","sales.view","sales.create_quote","leads.view","leads.manage"],[n.i.FINANCE_MANAGER]:["finance.view","finance.manage_invoices","finance.create_invoice","finance.sync_erp","finance.view_contracts","finance.manage_integrations"],[n.i.SALES_AGENT]:["sales.view","sales.create_quote","leads.view"],[n.i.CALL_CENTER]:["leads.view","leads.manage"],[n.i.COORDINATOR]:["finance.view_contracts"]},l=(0,r.createContext)(void 0),o=e=>{let{children:a}=e,[s,n]=(0,r.useState)(null),[o,c]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{let e=localStorage.getItem("mavera_user");if(e)try{n(JSON.parse(e))}catch(e){console.error("Failed to parse stored user:",e),localStorage.removeItem("mavera_user")}c(!1)},[]),o)?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-mavera-gold border-t-transparent rounded-full animate-spin"})}):(0,t.jsx)(l.Provider,{value:{user:s,login:e=>{n(e),localStorage.setItem("mavera_user",JSON.stringify(e))},logout:()=>{n(null),localStorage.removeItem("mavera_user")},hasPermission:e=>{if(!s)return!1;let a=(s.roles||[s.role]).flatMap(e=>i[e]||[]);return new Set([...a,...s.customPermissions||[]]).has(e)}},children:a})},c=()=>{let e=(0,r.useContext)(l);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},d=e=>{let{hasPermission:a}=c();return a(e)}},53537:function(e,a,s){"use strict";var t,r;s.d(a,{i:function(){return t}}),(r=t||(t={})).CALL_CENTER="CALL_CENTER",r.SALES_AGENT="SALES_AGENT",r.FINANCE_MANAGER="FINANCE_MANAGER",r.SUPER_ADMIN="SUPER_ADMIN",r.COORDINATOR="COORDINATOR"},52445:function(){}},function(e){e.O(0,[488,169,971,69,744],function(){return e(e.s=30052)}),_N_E=e.O()}]);